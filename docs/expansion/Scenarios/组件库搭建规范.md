---
title: å‰ç«¯ ui ç»„ä»¶åº“æ­å»ºè§„èŒƒ
theme: solarized-dark
---

# å‰ç«¯ ui ç»„ä»¶åº“æ­å»ºè§„èŒƒ

## ä¸€ã€`Monorepo`

**`Monorepo`**ï¼ˆå•ä¸€ä»£ç ä»“åº“ï¼‰æ˜¯ä¸€ç§ä»£ç ç®¡ç†æ¨¡å¼ï¼ŒæŒ‡çš„æ˜¯**å°†å¤šä¸ªé¡¹ç›®æˆ–åŒ…æ”¾åœ¨åŒä¸€ä¸ªä»£ç ä»“åº“ä¸­è¿›è¡Œç®¡ç†**ï¼Œè€Œä¸æ˜¯æ¯ä¸ªé¡¹ç›®ä¸€ä¸ªä»“åº“ï¼ˆ **`Polyrepo`**ï¼‰ã€‚

### **1. æ ¸å¿ƒæ¦‚å¿µ**

- **`Mono`** = å•ä¸€
- **`Repo`** = ä»£ç ä»“åº“
- å‰ç«¯ç»„ä»¶åº“ç»“æ„é€šå¸¸æ˜¯è¿™æ ·ï¼š

```tex
my-ui/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui/          # UI ç»„ä»¶åº“
â”‚   â”œâ”€â”€ hooks/       # å·¥å…·åº“
â”‚   â””â”€â”€ api/         # API SDK
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ docs/        # ç»„ä»¶åº“æ–‡æ¡£
â”‚   â””â”€â”€ demos/       # ç»„ä»¶demo
â””â”€â”€ turbo.json       # Turborepo é…ç½®
```

æ‰€æœ‰é¡¹ç›®ï¼ˆ`apps`ã€ç»„ä»¶ã€å·¥å…·åº“ï¼‰æ”¾åœ¨ä¸€ä¸ªä»“åº“é‡Œï¼Œç»Ÿä¸€ç®¡ç†ç‰ˆæœ¬ã€ä¾èµ–å’Œæ„å»ºã€‚

### **2. `Monorepo` çš„ä¼˜ç‚¹**

- **ç»Ÿä¸€ç®¡ç†ä¾èµ–**ï¼ˆä¸æ€•ç‰ˆæœ¬ä¸ä¸€è‡´ï¼‰
- **ä¸€æ¬¡æäº¤å¯å½±å“å¤šä¸ªé¡¹ç›®**ï¼ˆè·¨åŒ…ä¿®æ”¹æ–¹ä¾¿ï¼‰
- **å…±äº«ä»£ç æ–¹ä¾¿**ï¼ˆç›´æ¥ `import`ï¼‰
- **ä»£ç å¯è§æ€§é«˜**ï¼ˆæ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°å…¨éƒ¨ä»£ç ï¼‰
- **é…åˆ Turborepo / Nx å¯ä»¥æ™ºèƒ½æ„å»ºå’Œç¼“å­˜**

### **3. `Monorepo`é…ç½®**

**åˆ›å»º `pnpm-workspace.yaml` â½‚ä»¶**ï¼šæ˜¾å¼å£°æ˜æ‰€æœ‰åŒ…å«â¼¦é¡¹â½¬çš„â½¬å½•è·¯å¾„

```json
packages:
    - 'apps/*'
    - 'packages/*'
```

## äºŒã€è§„èŒƒåŒ–è®¾è®¡

### 1. `JS` è§„èŒƒï¼š `ESLint + Prettier`

#### 1.1 `ESLint`

**ä»‹ç»**

- ä¸€ä¸ª **JavaScript/TypeScript ä»£ç è´¨é‡å’Œé£æ ¼æ£€æŸ¥å·¥å…·**
- ä¸»è¦ä½œç”¨ï¼š
  1. æ£€æŸ¥è¯­æ³•é”™è¯¯
  2. ç»Ÿä¸€ä»£ç é£æ ¼
  3. æä¾›è‡ªåŠ¨ä¿®å¤åŠŸèƒ½ï¼ˆ`--fix`ï¼‰

**å®‰è£… ESLint**

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

```shell
# npm
npm install eslint --save-dev

# pnpm
pnpm add eslint -D
```

**æ·»åŠ é…ç½®æ–‡ä»¶**

æ ¹ç›®å½•æ·»åŠ `eslint.config.js`

è¿™é‡Œè¿˜éœ€è¦å®‰è£…`@eslint/js`(å®˜æ–¹å†…ç½®çš„ JS è§„åˆ™é›†)å’Œ`typescript-eslint`(TypeScript çš„ ESLint è§£æå™¨å’Œæ’ä»¶)ï¼Œä½¿ç”¨`extends`ç›´æ¥ç»§æ‰¿`js`å’Œ`typescrpit`ç›¸å…³çš„é…ç½®ã€‚è¯¦ç»†é…ç½®è§„åˆ™æŸ¥çœ‹[eslint å®˜ç½‘](https://eslint.org/)

```shell
pnpm add -D eslint @eslint/js typescript typescript-eslint
```

```js
import js from '@eslint/js';
import tseslint from 'typescript-eslint';

export default tseslint.config({
  // ç»§æ‰¿è‡ªä»€ä¹ˆé…ç½®
  extends: [js.configs.recommended, ...tseslint.configs.recommended],
  // å“ªäº›æ–‡ä»¶éœ€è¦è¢«eslintæ£€æŸ¥
  files: ['**/*.{ts,tsx,js}'],
  //å“ªäº›æ–‡ä»¶ä¸éœ€è¦è¢«eslintæ£€æŸ¥
  ignores: ['apps/**/*/{tmp,.dumi}/**/*', '*.js', '**/*/build/**/*', '**/*/es/**/*', '**/*/dist/**/*'],
  // è‡ªå®šä¹‰è§„åˆ™
  rules: {
    // ç¦æ­¢ä½¿ç”¨console
    'no-console': 'off',
  },
  // è¯­è¨€é€‰é¡¹
  languageOptions: {
    // è§£æå™¨
    parser: tseslint.parser,
    // è§£æå™¨é€‰é¡¹
    parserOptions: {
      // tsé¡¹ç›®çš„é…ç½®æ–‡ä»¶
      project: [],
      // tsé…ç½®æ ¹ç›®å½•
      tsconfigRootDir: import.meta.url,
    },
  },
});
```

**â½‚ä»¶åç¼€åé—®é¢˜**

- **ES æ¨¡å—é—®é¢˜**ï¼šå½“ä½¿â½¤`export default`è¯­æ³•æ—¶ï¼ŒNode.js é»˜è®¤ä¼šè®¤ä¸ºæ˜¯`CommonJS`æ¨¡å—
- **è§£å†³â½…æ¡ˆ**ï¼š
  - å°†â½‚ä»¶åç¼€æ”¹ä¸º`.mjs`ï¼Œ`eslint.config.mjs`
  - åœ¨`package.json`ä¸­æ·»åŠ `"type": "module"`
- è¿™æ˜¯æ–°ç‰ˆæœ¬ Node.js ä¸­å¸¸â»…çš„å‘ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„â½‚ä»¶åç¼€å

**éªŒè¯`Eslint`**

- åœ¨`package.json`ä¸­æ·»åŠ æ‰§è¡Œå‘½ä»¤

```json
 "scripts": {
        "lint:es": "eslint \"{packages,apps}/**/*.{js,jsx,ts,tsx}\"",
  },
```

- é€šè¿‡è¿â¾`pnpm run lint:es`å‘½ä»¤éªŒè¯é…ç½®æ˜¯å¦â½£æ•ˆ

```shell
pnpm run lint:es
```

- å¸¸â»…é”™è¯¯
  - è¯­æ³•é”™è¯¯ï¼ˆå¦‚ç¼ºå°‘é€—å·ï¼‰
  - è§„åˆ™åç§°æ‹¼å†™é”™è¯¯
  - è§„åˆ™å€¼æ ¼å¼ä¸æ­£ç¡®

#### 1.2 `prettier`

**Prettier æ˜¯ä»€ä¹ˆ**

- ä¸»è¦åš **ä»£ç æ ¼å¼åŒ–**ï¼ˆç¼©è¿›ã€å¼•å·ã€åˆ†å·ç­‰ï¼‰
- ä¸å…³å¿ƒè¯­æ³•è§„åˆ™ï¼ˆé‚£æ˜¯ `ESLint` çš„æ´»ï¼‰
- å®ƒçš„ç›®æ ‡æ˜¯ï¼š**ç»Ÿä¸€é£æ ¼ï¼Œä¸å†äº‰è®ºä»£ç æ ¼å¼**

**å®‰è£… Prettier**

```shell
# pnpm
pnpm add -D prettier
```

**åˆ›å»ºé…ç½®æ–‡ä»¶**

æ ¹ç›®å½•ä¸‹æ–°å»º`.prettierrc`æ–‡ä»¶

```js
export default {
  printWidth: 100, // æ¯è¡Œæœ€å¤§é•¿åº¦
  tabWidth: 2, // ç¼©è¿›å®½åº¦
  useTabs: false, // æ˜¯å¦ç”¨ tab
  semi: true, // è¯­å¥æœ«å°¾åŠ åˆ†å·
  singleQuote: true, // ä½¿ç”¨å•å¼•å·
  trailingComma: 'all', // å¤šè¡Œæ—¶æœ«å°¾é€—å·
  bracketSpacing: true, // å¯¹è±¡å¤§æ‹¬å·å†…ç•™ç©ºæ ¼
  arrowParens: 'always', // ç®­å¤´å‡½æ•°å‚æ•°æ€»æ˜¯åŠ æ‹¬å·
};
```

**å¿½ç•¥ä¸éœ€è¦æ ¼å¼åŒ–çš„æ–‡ä»¶**

æ ¹ç›®å½•ä¸‹æ–°å»º`.prettierignore`æ–‡ä»¶

```js
node_modules;
dist;
build;
coverage;
```

**ä½¿ç”¨ç¼–è¾‘å™¨æ’ä»¶**

![image-20250813142437540](./img/ui1.png)

### **2. æ ·å¼è§„èŒƒ: `Stylelint`**

**`Stylelint` æ˜¯ä»€ä¹ˆ**

- `CSS/SCSS/LESS` ä»£ç æ£€æŸ¥å·¥å…·
- ç±»ä¼¼ `ESLint`ï¼Œä½†é’ˆå¯¹æ ·å¼ä»£ç 
- åŠŸèƒ½ï¼š
  - è§„èŒƒ `CSS/SCSS/LESS` ä»£ç é£æ ¼
  - æ£€æŸ¥é”™è¯¯æˆ–æ½œåœ¨é—®é¢˜ï¼ˆå¦‚é‡å¤å±æ€§ã€æ— æ•ˆé¢œè‰²ï¼‰
  - æ”¯æŒè‡ªåŠ¨ä¿®å¤ï¼ˆ`--fix`ï¼‰

**å®‰è£…**

```shell
pnpm add -D stylelint stylelint-config-standard
```

- `stylelint` â†’ æ ¸å¿ƒå·¥å…·
- `stylelint-config-standard` â†’ å®˜æ–¹æ¨èçš„åŸºç¡€è§„åˆ™é›†

å¦‚æœä½¿ç”¨ `SCSS/LESS`

```shell
pnpm add -D stylelint-scss stylelint-less
```

**é…ç½® `Stylelint`**

[Stylelint å®˜æ–¹æ–‡æ¡£](https://stylelint.io/)

æ ¹ç›®å½•ä¸‹æ–°å»º`stylelint.config.js`

```js
module.exports = {
  extends: ['stylelint-config-standard'],
  rules: {
    indentation: 2, // ç¼©è¿› 2 ä¸ªç©ºæ ¼
    'string-quotes': 'double', // å­—ç¬¦ä¸²ç”¨åŒå¼•å·
    'color-hex-case': 'lower', // åå…­è¿›åˆ¶é¢œè‰²å°å†™
    'max-empty-lines': 2, // æœ€å¤§ç©ºè¡Œ 2 è¡Œ
  },
};
```

å¦‚æœæ˜¯ `SCSS`ï¼Œå¯ä»¥åŠ ï¼š

```js
module.exports = {
  extends: ['stylelint-config-standard', 'stylelint-config-recommended-scss'],
  plugins: ['stylelint-scss'],
  rules: {
    'scss/dollar-variable-pattern': '^foo', // SCSS å˜é‡å‘½åè§„åˆ™
  },
};
```

**éªŒè¯`stylelint`**

- åœ¨`package.json`ä¸­æ·»åŠ æ‰§è¡Œå‘½ä»¤

```json
 "scripts": {
         "lint:style": "stylelint \"{packages,apps}/**/*.{css,ts}\"",
  },
```

- é€šè¿‡è¿â¾`pnpm run lint:style`å‘½ä»¤éªŒè¯é…ç½®æ˜¯å¦â½£æ•ˆ

```shell
pnpm run lint:style
```

### 3. æ‹¼å†™æ£€æŸ¥:`cspell`

**cspell æ˜¯ä»€ä¹ˆ**

- **`Code Spell Checker`**ï¼Œä»£ç æ‹¼å†™æ£€æŸ¥å·¥å…·
- æ£€æŸ¥ï¼šå˜é‡åã€æ³¨é‡Šã€å­—ç¬¦ä¸²ç­‰æ‹¼å†™é”™è¯¯
- é€‚åˆ `JS/TS/React/Vue` é¡¹ç›®ï¼Œå‡å°‘è‹±æ–‡æ‹¼å†™ `bug`

**å®‰è£…**

```shell
pnpm add -g cspell
```

**åˆå§‹åŒ–é…ç½®**

åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼š

```shell
npx cspell --init
```

ä¼šç”Ÿæˆ `cspell.json`ï¼Œé»˜è®¤é…ç½®ç¤ºä¾‹ï¼š

```js
{
  "version": "0.2",
  "language": "en",
  "words": [
    "aiolimp",
    "vuex",
    "React"
  ],
  "ignoreWords": [
    "npm",
    "pnpm"
  ],
  "ignorePaths": [
    "node_modules/**",
    "dist/**"
  ]
}
```

- **`words`**ï¼šå…è®¸çš„è‡ªå®šä¹‰è¯ï¼ˆä¸“æœ‰åè¯ã€åº“åç­‰ï¼‰
- **`ignoreWords`**ï¼šå¿½ç•¥çš„è¯
- **`ignorePaths`**ï¼šå¿½ç•¥ç›®å½•

**æ£€æŸ¥ä»£ç **

- åœ¨`package.json`ä¸­æ·»åŠ æ‰§è¡Œå‘½ä»¤

```json
 "scripts": {
       "spellcheck": "cspell lint --dot --gitignore --color --cache --show-suggestions \"   (packages|apps)/**/*.@(html|js|cjs|mjs|ts|tsx|css|scss|md)\"",
  },
```

- é€šè¿‡è¿â¾`pnpm run spellcheck`å‘½ä»¤éªŒè¯é…ç½®æ˜¯å¦â½£æ•ˆ

```shell
pnpm run spellcheck
```

**ä¿®å¤**

æ ¹ç›®å½•ä¸‹æ·»åŠ `.cspell`æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹é‡Œæ·»åŠ `custom-words.txt`ï¼Œå¯ä»¥å°†ä¸éœ€è¦æ‹¼å†™æ£€æŸ¥çš„å•è¯æ·»åŠ åˆ°æ–‡ä»¶é‡Œã€‚

åœ¨`cspell.json`ä¸­æ·»åŠ é…ç½®

```json
 "dictionaries": ["custom-words"],
    "dictionaryDefinitions": [
        {
            "name": "custom-words",
            "path": "./.cspell/custom-words.txt",
            "addWords": true
        }
    ],
```

### 4. æäº¤è§„èŒƒ: `Commitlint + Husky`

**`Husky` + `Commitlint` èƒ½åšä»€ä¹ˆ**

- **`Husky`**ï¼šç®¡ç† Git hooksï¼ˆæäº¤å‰ã€æ¨é€å‰ç­‰è‡ªåŠ¨æ‰§è¡Œè„šæœ¬ï¼‰
- **`Commitlint`**ï¼šæ£€æŸ¥ `Git` æäº¤ä¿¡æ¯æ˜¯å¦ç¬¦åˆè§„èŒƒï¼ˆå¦‚ `Angular` æäº¤è§„èŒƒï¼‰

æ¯”å¦‚ï¼Œè¦æ±‚æäº¤å¿…é¡»é•¿è¿™æ ·ï¼š

```txt
feat(user): æ–°å¢ç”¨æˆ·ç™»å½•åŠŸèƒ½
fix(api): ä¿®å¤æ¥å£è¶…æ—¶é—®é¢˜
```

**å®‰è£…ä¾èµ–**

```shell
pnpm add -D husky @commitlint/{cli,config-conventional}
```

- `husky` â†’ ç”¨æ¥æ‰§è¡Œ `Git hooks`
- `@commitlint/cli` â†’ `Commitlint` æ ¸å¿ƒå·¥å…·
- `@commitlint/config-conventional` â†’ `Angular` é£æ ¼çš„æäº¤è§„èŒƒï¼ˆä¸»æµï¼‰

**åˆå§‹åŒ– Husky**

```js
npx husky init
```

å®ƒä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆï¼š

```js
.husky/
â””â”€â”€ pre-commit
    commit-msg
```

å¹¶åœ¨ package.json é‡Œæ·»åŠ ï¼š

```json
{
  "scripts": {
    "prepare": "husky"
  }
}
```

**`commit-msg`:**

- **è§¦å‘æ—¶æœº**ï¼šåœ¨å†™å¥½ `commit message` åï¼Œ**æäº¤æ­£å¼ä¿å­˜ä¹‹å‰**æ‰§è¡Œï¼Œ
- **ä½œç”¨**ï¼š
  - æ ¡éªŒæäº¤ä¿¡æ¯æ ¼å¼ï¼ˆé…åˆ `Commitlint`ï¼‰
- **ç›®çš„**ï¼šé˜²æ­¢éšæ„å†™ `update`ã€`test` è¿™ç§æ— æ„ä¹‰æäº¤

```js
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx --no -- commitlint --edit "$1"
```

**`pre-commit`**

- **è§¦å‘æ—¶æœº**ï¼šè¿è¡Œ `git commit` åï¼Œ`Git` ä¼šåœ¨**çœŸæ­£å†™å…¥ `commit`**ä¹‹å‰æ‰§è¡Œ,å¯ä»¥é…å’Œå…¶ä»–ç±»å‹çš„æ£€æŸ¥
- **ä½œç”¨**ï¼š
  - æ£€æŸ¥ä»£ç æ ¼å¼ï¼ˆ`ESLint`ã€`Prettier`ï¼‰
  - è¿è¡Œæµ‹è¯•ï¼ˆ`Jest`ã€`Vitest`ï¼‰
  - æ ¼å¼åŒ–ä»£ç ï¼ˆ`lint-staged`ï¼‰
- **ç›®çš„**ï¼šé˜²æ­¢ä¸ç¬¦åˆè§„èŒƒçš„ä»£ç è¿›å…¥ä»“åº“

```js
#!/bin/sh
. "$(dirname -- "$0")/_/husky.sh"

# pnpm lint
pnpm spellcheck && npx lint-staged

```

**é…ç½® Commitlint**

æ¨èæ­é…**commitizen**å’Œ**cz-git**ä½¿ç”¨

- **commitizen**ï¼šè®©ä½ ç”¨å‘½ä»¤è¡Œäº¤äº’å¼é€‰æ‹©æäº¤ç±»å‹ï¼ˆæ›¿ä»£æ‰‹å†™ `commit message`ï¼‰
- **cz-git**ï¼š`Commitizen` çš„ä¸€ä¸ªé€‚é…å™¨ï¼Œæ”¯æŒæ›´å¤šé…ç½®å’Œè‡ªå®šä¹‰äº¤äº’ç•Œé¢

åœ¨ package.json ä¸­æ·»åŠ ï¼š

```json
"scripts": {
      "commit": "git-cz"
  },

"config": {
    "commitizen": {
        "path": "node_modules/cz-git"
    }
},
```

æ ¹ç›®å½•ä¸‹æ·»åŠ `commitlint.config.js`

```json
// Emoji
/** @type {import('cz-git').UserConfig} */
module.exports = {
    extends: ['@commitlint/config-conventional'], // extends can be nested
    parserPreset: 'conventional-changelog-conventionalcommits',
    prompt: {
        settings: {},
        messages: {
            skip: ':skip',
            max: 'upper %d chars',
            min: '%d chars at least',
            emptyWarning: 'can not be empty',
            upperLimitWarning: 'over limit',
            lowerLimitWarning: 'below limit'
        },
        types: [
            { value: 'feat', name: 'feat:     âœ¨  A new feature', emoji: 'âœ¨ ' },
            { value: 'fix', name: 'fix:      ğŸ›  A bug fix', emoji: 'ğŸ› ' },
            { value: 'docs', name: 'docs:     ğŸ“  Documentation only changes', emoji: 'ğŸ“ ' },
            {
                value: 'style',
                name: 'style:    ğŸ’„  Changes that do not affect the meaning of the code',
                emoji: 'ğŸ’„ '
            },
            {
                value: 'refactor',
                name: 'refactor: ğŸ“¦ï¸   A code change that neither fixes a bug nor adds a feature',
                emoji: 'ğŸ“¦ï¸ '
            },
            {
                value: 'perf',
                name: 'perf:     ğŸš€  A code change that improves performance',
                emoji: 'ğŸš€ '
            },
            {
                value: 'test',
                name: 'test:     ğŸš¨  Adding missing tests or correcting existing tests',
                emoji: 'ğŸš¨ '
            },
            {
                value: 'build',
                name: 'build:    ğŸ›    Changes that affect the build system or external dependencies',
                emoji: 'ğŸ›  '
            },
            {
                value: 'ci',
                name: 'ci:       ğŸ¡  Changes to our CI configuration files and scripts',
                emoji: 'ğŸ¡ '
            },
            {
                value: 'chore',
                name: "chore:    ğŸ”¨  Other changes that don't modify src or test files",
                emoji: 'ğŸ”¨ '
            },
            { value: 'revert', name: 'revert:   âªï¸  Reverts a previous commit', emoji: ':rewind:' }
        ],
        useEmoji: true,
        confirmColorize: true,
        emojiAlign: 'center',
        questions: {
            scope: {
                description: 'What is the scope of this change (e.g. component or file name)'
            },
            subject: {
                description: 'Write a short, imperative tense description of the change'
            },
            body: {
                description: 'Provide a longer description of the change'
            },
            isBreaking: {
                description: 'Are there any breaking changes?'
            },
            breakingBody: {
                description: 'A BREAKING CHANGE commit requires a body. Please enter a longer description of the commit itself'
            },
            breaking: {
                description: 'Describe the breaking changes'
            },
            isIssueAffected: {
                description: 'Does this change affect any open issues?'
            },
            issuesBody: {
                description: 'If issues are closed, the commit requires a body. Please enter a longer description of the commit itself'
            },
            issues: {
                description: 'Add issue references (e.g. "fix #123", "re #123".)'
            }
        }
    }
}
```

è¿™æ ·æ‰§è¡Œ `pnpm commit` æ—¶å°±ä¼šå‡ºç°æ¼‚äº®çš„äº¤äº’å¼é€‰æ‹©ç•Œé¢ï¼Œæ”¯æŒä¸­æ–‡æç¤ºå’Œ `emoji`

![image-20250813145141404](./img/ui2.png)

**æœ€ç»ˆæ•ˆæœ**

æäº¤è®°å½•ä¼šåƒè¿™æ ·ï¼š

```
feat(api): âœ¨ æ–°å¢ç”¨æˆ·ç™»å½•æ¥å£
fix(ui): ğŸ› ä¿®å¤æŒ‰é’®æ ·å¼é”™ä½
```

- ç»Ÿä¸€é£æ ¼
- æ”¯æŒ `emoji`
- äº¤äº’å¼é€‰æ‹©ï¼Œé›¶è®°å¿†æˆæœ¬
- è‡ªåŠ¨æ ¡éªŒï¼Œæäº¤å³è§„èŒƒ

### 5.å¢é‡æ£€æŸ¥é…ç½®`Lint-staged`

**lint-staged æ˜¯ä»€ä¹ˆ**

- **ä½œç”¨**ï¼šåªå¯¹æš‚å­˜åŒºï¼ˆ`git add` åçš„æ–‡ä»¶ï¼‰æ‰§è¡Œ lint æˆ–æ ¼å¼åŒ–æ“ä½œ
- **ä¼˜åŠ¿**ï¼š
  - ä¸ä¼šå…¨é‡æ£€æŸ¥ï¼ˆæ¯”ç›´æ¥ `eslint` . å¿«å¾—å¤šï¼‰
  - åªæ”¹ä½ è¿™æ¬¡æäº¤çš„æ–‡ä»¶
  - é€‚åˆé…åˆ `Husky` çš„ **`pre-commit hook`**

**å®‰è£…**

```shell
pnpm add -D lint-staged
```

**é…ç½® lint-staged**

åœ¨**package.json**ä¸­æ·»åŠ ï¼š

```js
"lint-staged": {
  "*.{js,ts,vue,tsx}": ["eslint --fix", "prettier --write"],
  "*.md": ["prettier --write"]
},
```

- `*.{js,ts,vue,tsx}`â†’ åŒ¹é… `JS/TS/Vue/TSX` æ–‡ä»¶
- `eslint --fix` â†’ è‡ªåŠ¨ä¿®å¤ `ESLint` é—®é¢˜
- `prettier --write` â†’ è‡ªåŠ¨æ ¼å¼åŒ–
- `*.md` â†’ åªæ ¼å¼åŒ– `Markdown` æ–‡ä»¶

**æäº¤æµç¨‹**

1. `Husky` **pre-commit hook** è§¦å‘
2. `lint-staged` æ‰¾å‡ºæš‚å­˜åŒºæ–‡ä»¶
3. æŒ‰é…ç½®æ‰§è¡Œ `ESLint / Prettier`
4. å¦‚æœæœ‰é”™è¯¯ä¸”æ— æ³•ä¿®å¤ï¼Œæäº¤ä¼šè¢«ä¸­æ–­

## ä¸‰ã€å·¥ç¨‹åŒ–é…ç½®

### 1. **`tsup`**

`ui`åº“é€šå¸¸ä½¿ç”¨`tsup`è¿›è¡Œæ‰“åŒ…æ„å»ºï¼Œå®ƒæ˜¯ç›®å‰ TypeScript é¡¹ç›®é‡Œå¾ˆæµè¡Œçš„æ‰“åŒ…å·¥å…·ï¼Œå°¤å…¶é€‚åˆ**åº“å¼€å‘**ã€‚

**`tsup` æ˜¯ä»€ä¹ˆ**

- ä¸€ä¸ª **é›¶é…ç½®** çš„ `TypeScript` æ‰“åŒ…å·¥å…·
- åŸºäº [esbuild](https://esbuild.github.io/)ï¼ˆè¶…å¿«çš„æ‰“åŒ…å™¨ï¼‰
- æ”¯æŒç”Ÿæˆå¤šç§æ ¼å¼ï¼š`esm`ã€`cjs`ã€`iife`
- è‡ªåŠ¨ç±»å‹å£°æ˜æ–‡ä»¶ `.d.ts`
- å†…ç½®æ”¯æŒï¼š
  - `TypeScript`
  - `JSX/TSX`
  - `Tree-shaking`
  - ä»£ç å‹ç¼©
  - `Sourcemap`

**é€‚ç”¨åœºæ™¯**

- ä½ åœ¨å†™ä¸€ä¸ª **`npm` åŒ…/å·¥å…·åº“**
- éœ€è¦æ‰“åŒ…æˆå¤šç§æ ¼å¼ï¼ˆæ–¹ä¾¿åˆ«äººå¼•å…¥ï¼‰
- ä¸æƒ³æ‰‹åŠ¨å†™å¤æ‚çš„ `Rollup/Webpack` é…ç½®
- å¸Œæœ›æ„å»ºé€Ÿåº¦å¿«

**å®‰è£…**

```shell
pnpm add -D tsup typescript
```

**åŸºæœ¬ç”¨æ³•**

`package.json`ï¼š

```json
"scripts": {
    "dev": "tsup --watch",
    "build": "tsup",
},
```

`UI`é¡¹ç›®æ ¹ç›®å½•ä¸‹æ·»åŠ `tsup.config.ts`

```ts
import { defineConfig } from 'tsup';

export default defineConfig({
  entry: ['src'], // å…¥å£æ–‡ä»¶
  dts: true, // ç”Ÿæˆdtsæ–‡ä»¶
  splitting: false, // æ˜¯å¦æ‹†åˆ†æ–‡ä»¶ï¼Œuiåº“ä¸€èˆ¬ä¸éœ€è¦
  sourcemap: false, // ç”Ÿæˆsourcemapæ–‡ä»¶
  clean: true, // æ¸…é™¤distç›®å½•
  outDir: 'es', // ä¿®æ”¹æ‰“åŒ…ç›®å½•
  format: ['esm'], // è®¾ç½®æ‰“åŒ…æ ¼å¼ä¸ºesm
});
```

æ‰“åŒ…åç”Ÿæˆæ–‡ä»¶ï¼š

![image-20250813152016091](./img/ui3.png)

**CLI å‚æ•°é€ŸæŸ¥**

| **å‚æ•°**    | **ä½œç”¨**                   |
| ----------- | -------------------------- |
| --dts       | ç”Ÿæˆ .d.ts ç±»å‹æ–‡ä»¶        |
| --format    | è¾“å‡ºæ ¼å¼ï¼ˆcjsã€esmã€iifeï¼‰ |
| --sourcemap | ç”Ÿæˆ SourceMap             |
| --minify    | å‹ç¼©è¾“å‡º                   |
| --watch     | ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼ˆå¼€å‘æ¨¡å¼ï¼‰   |
| --clean     | æ„å»ºå‰æ¸…ç©ºè¾“å‡ºç›®å½•         |

### 2. `turbo`

**`turbo` æ˜¯ä»€ä¹ˆ**

- **`Vercel` å‡ºå“**çš„ `Monorepo` æ„å»ºå·¥å…·
- æ ¸å¿ƒä½œç”¨ï¼š
  - åœ¨ `Monorepo` é‡Œé«˜æ•ˆæ‰§è¡Œä»»åŠ¡ï¼ˆæ„å»ºã€æµ‹è¯•ã€lint ç­‰ï¼‰
  - **ç¼“å­˜ä»»åŠ¡ç»“æœ**ï¼ˆæœ¬åœ°ç¼“å­˜ + è¿œç¨‹ç¼“å­˜ï¼‰
  - ä»»åŠ¡ä¾èµ–ç®¡ç†ï¼ˆå…ˆæ„å»ºä¾èµ–åŒ…ï¼Œå†æ„å»ºå½“å‰åŒ…ï¼‰
- å¯¹æ ‡ `Google` çš„ `Bazel`ï¼Œä½†é…ç½®æ›´ç®€å•ï¼Œå­¦ä¹ æ›²çº¿ä½

**æ ¸å¿ƒç‰¹ç‚¹**

- **æœ¬åœ°ç¼“å­˜**

  ç›¸åŒè¾“å…¥ï¼ˆä»£ç ã€ä¾èµ–ï¼‰ â†’ ç›´æ¥å¤ç”¨ä¸Šæ¬¡çš„æ„å»ºç»“æœ

- **è¿œç¨‹ç¼“å­˜**

  å¤šäººåä½œæ—¶ï¼Œä¸€ä¸ªäººæ„å»ºç»“æœ â†’ å…¶ä»–äººç›´æ¥å¤ç”¨

- **ä»»åŠ¡ä¾èµ–å…³ç³»ç®¡ç†**

  `dependsOn` å¯ä»¥å®šä¹‰ä»»åŠ¡æ‰§è¡Œé¡ºåº

- **è¾“å‡ºè¿½è¸ª**

  `outputs` å®šä¹‰å“ªäº›æ–‡ä»¶éœ€è¦ç¼“å­˜

- **æ”¯æŒå¹¶è¡Œä¸ä¸²è¡Œæ‰§è¡Œ**

**å®‰è£…**

```shell
pnpm add -D turbo
```

ç„¶ååˆ›å»ºé…ç½®æ–‡ä»¶ï¼š

```shell
npx turbo init
```

ä¼šç”Ÿæˆï¼š

```
turbo.json
```

**åŸºç¡€é…ç½®ç¤ºä¾‹**

```json
{
  "$schema": "https://turbo.build/schema.json",
  "pipeline": {
    "build": {
      "dependsOn": ["^build"], // å…ˆæ„å»ºä¾èµ–åŒ…
      "outputs": ["dist/**"] // ç¼“å­˜æ„å»ºäº§ç‰©
    },
    "dev": {
      "cache": false, // å¼€å‘æ¨¡å¼ä¸ç¼“å­˜
      "persistent": true // æŒç»­è¿è¡Œ
    },
    "lint": {
      "outputs": []
    },
    "test": {
      "dependsOn": ["build"], // æµ‹è¯•å‰å…ˆæ„å»º
      "outputs": ["coverage/**"] // ç¼“å­˜æµ‹è¯•è¦†ç›–ç‡
    }
  }
}
```

**å¸¸ç”¨å‘½ä»¤**

```shell
# æ„å»ºæ‰€æœ‰åŒ…ï¼ˆè‡ªåŠ¨æŒ‰ä¾èµ–é¡ºåºï¼‰
pnpm turbo run build

# è¿è¡Œæ‰€æœ‰åŒ…çš„ dev è„šæœ¬ï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰
pnpm turbo run dev

# åªè¿è¡ŒæŸä¸ªåŒ…
pnpm turbo run build --filter=ui

# è¿è¡ŒæŒ‡å®šåŒ…åŠä¾èµ–åŒ…
pnpm turbo run build --filter=web^...

# æ¸…ç†ç¼“å­˜
pnpm turbo clean
```

**å’Œ pnpm workspace é…åˆ**

```json
{
  "scripts": {
    "build": "turbo run build",
    "dev": "turbo run dev",
    "lint": "turbo run lint"
  }
}
```

pnpm-workspace.yamlï¼š

```json
packages:
  - "apps/*"
  - "packages/*"
```

è¿™æ · Turbo ä¼šè‡ªåŠ¨è¯†åˆ«ä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚ï¼š

- web ä¾èµ– ui
- å…ˆæ„å»º ui â†’ å†æ„å»º web
