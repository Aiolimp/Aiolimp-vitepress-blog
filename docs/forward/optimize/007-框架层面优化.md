---
title: 007-æ¡†æ¶å±‚é¢ä¼˜åŒ–
theme: solarized-dark
---

# æ¡†æ¶å±‚é¢ä¼˜åŒ–

## **ä¸€ã€Vue å±‚é¢çš„ä¼˜åŒ–**

### **1. ç»„ä»¶æ‡’åŠ è½½ + è·¯ç”±æ‡’åŠ è½½**

- Vue Router æä¾› defineAsyncComponent å’Œ () => import()ï¼š

```js
// è·¯ç”±æ‡’åŠ è½½
const routes = [
  {
    path: '/about',
    component: () => import('@/views/About.vue'),
  },
];

// ç»„ä»¶æ‡’åŠ è½½
import { defineAsyncComponent } from 'vue';
const AsyncComp = defineAsyncComponent(() => import('./BigComp.vue'));
```

ğŸ‘‰ å‡å°‘é¦–å± bundle ä½“ç§¯ï¼Œæå‡åŠ è½½é€Ÿåº¦ã€‚

### **2. KeepAlive ç¼“å­˜**

- å¯¹åˆ‡æ¢é¢‘ç¹çš„é¡µé¢/ç»„ä»¶ï¼Œä½¿ç”¨ `<KeepAlive>` ä¿æŒçŠ¶æ€å’Œ DOMï¼Œå‡å°‘é‡å¤æ¸²æŸ“ï¼š

```vue
<router-view v-slot="{ Component }">
  <keep-alive>
    <component :is="Component" />
  </keep-alive>
</router-view>
```

### **3. Vue å“åº”å¼ä¼˜åŒ–**

- ä½¿ç”¨ shallowRefã€shallowReactive é¿å…æ·±å±‚ç›‘å¬ã€‚
- å¤§åˆ—è¡¨ç”¨ v-memoï¼ˆVue3.3+ï¼‰ç¼“å­˜è™šæ‹ŸèŠ‚ç‚¹ï¼Œé¿å…ä¸å¿…è¦ diffã€‚

```js
<div v-for="item in list" :key="item.id" v-memo="[item.id]">
  {{ item.text }}
</div>
```

### **4. SSR / SSGï¼ˆNuxtï¼‰**

- SSR æå‡é¦–å±æ¸²æŸ“é€Ÿåº¦ï¼ŒSEO æ›´å¥½ã€‚
- Nuxt 3 / VitePress ç­‰æ”¯æŒé™æ€ç”Ÿæˆï¼Œé€‚åˆæ–‡æ¡£/å†…å®¹å‹é¡¹ç›®ã€‚

## React å±‚é¢çš„ä¼˜åŒ–

### 1. memo

memo å…è®¸ç»„ä»¶åœ¨ props æ²¡æœ‰æ”¹å˜çš„æƒ…å†µä¸‹è·³è¿‡é‡æ–°æ¸²æŸ“

é»˜è®¤é€šè¿‡ Object.is æ¯”è¾ƒæ¯ä¸ª propï¼Œå¯é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¼ å…¥è‡ªå®šä¹‰å‡½æ•°æ¥æ§åˆ¶å¯¹æ¯”è¿‡ç¨‹

```js
const Chart = memo(function Chart({ dataPoints }) {
  // ...
}, arePropsEqual);

function arePropsEqual(oldProps, newProps) {
  return (
    oldProps.dataPoints.length === newProps.dataPoints.length &&
    oldProps.dataPoints.every((oldPoint, index) => {
      const newPoint = newProps.dataPoints[index];
      return oldPoint.x === newPoint.x && oldPoint.y === newPoint.y;
    })
  );
}
```

### 2. useMemo

åœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“çš„æ—¶å€™èƒ½å¤Ÿç¼“å­˜è®¡ç®—çš„ç»“æœ

```js
import { useState, useMemo } from 'react';

function App() {
  const [count, setCount] = useState(0);

  const memoizedValue = useMemo(() => {
    //åˆ›å»º1000ä½æ•°ç»„
    const list = new Array(1000).fill(null).map((_, i) => i);

    //å¯¹æ•°ç»„æ±‚å’Œ
    const total = list.reduce((res, cur) => (res += cur), 0);

    //è¿”å›è®¡ç®—çš„ç»“æœ
    return count + total;

    //æ·»åŠ ä¾èµ–é¡¹ï¼Œåªæœ‰countæ”¹å˜æ—¶ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—
  }, [count]);

  return (
    <div>
      {memoizedValue}
      <button onClick={() => setCount((prev) => prev + 1)}>æŒ‰é’®</button>
    </div>
  );
}

export default App;
```

### 3. useCallback

ç¼“å­˜å‡½æ•°çš„å¼•ç”¨åœ°å€ï¼Œä»…åœ¨ä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šæ›´æ–°

```js
import { useState, memo } from 'react';

const App = () => {
  const [count, setCount] = useState(0);

  const handleClick = () => {
    setCount((prev) => prev + 1);
  };

  return (
    <div>
      {count}
      <MyButton handleClick={handleClick} />
    </div>
  );
};

const MyButton = memo(function MyButton({ handleClick }: { handleClick: () => void }) {
  console.log('å­ç»„ä»¶æ¸²æŸ“');
  return <button onClick={handleClick}>æŒ‰é’®</button>;
});

export default App;
```

ç‚¹å‡»æŒ‰é’®ï¼Œå¯ä»¥å‘ç°å³ä½¿å­ç»„ä»¶ä½¿ç”¨ memo åŒ…è£¹äº†ï¼Œä½†è¿˜æ˜¯æ›´æ–°äº†ï¼Œæ§åˆ¶å°æ‰“å°å‡ºâ€œå­ç»„ä»¶æ¸²æŸ“â€ã€‚è¿™æ˜¯å› ä¸ºçˆ¶ç»„ä»¶ App æ¯æ¬¡æ›´æ–°æ—¶ï¼Œå‡½æ•° handleClick æ¯æ¬¡éƒ½è¿”å›äº†æ–°çš„å¼•ç”¨åœ°å€ï¼Œå› æ­¤å¯¹äºå­ç»„ä»¶æ¥è¯´æ¯æ¬¡ä¼ å…¥çš„éƒ½æ˜¯ä¸ä¸€æ ·çš„å€¼ï¼Œä»è€Œè§¦å‘é‡æ¸²æŸ“ã€‚

åŒæ ·çš„ï¼Œ`å‡å°‘ä½¿ç”¨é€šè¿‡å†…è”å‡½æ•°ç»‘å®šäº‹ä»¶`ã€‚æ¯æ¬¡çˆ¶ç»„ä»¶æ›´æ–°æ—¶ï¼ŒåŒ¿åå‡½æ•°éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¼•ç”¨åœ°å€ï¼Œä»è€Œè§¦å‘å­ç»„ä»¶çš„é‡æ¸²æŸ“

```js
<MyButton handleClick={() => setCount((prev) => prev + 1)} />
```

ä½¿ç”¨ useCallback å¯ä»¥ç¼“å­˜å‡½æ•°çš„å¼•ç”¨åœ°å€ï¼Œå°† handleClick æ”¹ä¸º

```js
const handleClick = useCallback(() => {
  setCount((prev) => prev + 1);
}, []);
```

å†ç‚¹å‡»æŒ‰é’®ï¼Œä¼šå‘ç°å­ç»„ä»¶ä¸ä¼šå†é‡æ–°æ¸²æŸ“ã€‚

### 4. useTransition

ä½¿ç”¨ useTransition æä¾›çš„ startTransition æ¥æ ‡è®°ä¸€ä¸ªæ›´æ–°ä½œä¸ºä¸ç´§æ€¥çš„æ›´æ–°ã€‚è¿™æ®µä»»åŠ¡å¯ä»¥æ¥å—å»¶è¿Ÿæˆ–è¢«æ‰“æ–­æ¸²æŸ“ï¼Œè¿›è€Œå»ä¼˜å…ˆè€ƒè™‘æ›´é‡è¦çš„ä»»åŠ¡æ‰§è¡Œ

é¡µé¢ä¼šå…ˆæ˜¾ç¤º list2 çš„å†…å®¹ï¼Œä¹‹åå†æ˜¾ç¤º list1 çš„å†…å®¹

```js
import { useState, useEffect, useTransition } from "react";

const App = () => {
  const [list1, setList1] = useState<null[]>([]);
  const [list2, setList2] = useState<null[]>([]);
  const [isPending, startTransition] = useTransition();
  useEffect(() => {
    startTransition(() => {
       //å°†çŠ¶æ€æ›´æ–°æ ‡è®°ä¸º transition
      setList1(new Array(10000).fill(null));
    });
  }, []);
  useEffect(()=>{
    setList2(new Array(10000).fill(null));
  },[])
  return (
    <>
      {isPending ? "pending" : "nopending"}
      {list1.map((_, i) => (
        <div key={i}>{i}</div>
      ))}
      -----------------list2
      {list2.map((_, i) => (
        <div key={i}>6666</div>
      ))}
    </>
  );
};

export default App;
```

æ³¨é‡Šæ‰ list1 ç›¸å…³ä»£ç çš„æ‰§è¡Œå †æ ˆå›¾ï¼š

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dcb02d8c38b94ec7be8ef8f99054bf66~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1424&h=610&s=91627&e=png&b=e9f0fd)

å¯ä»¥çœ‹åˆ° layout ä¹‹åï¼Œä¸€ç›´åœ¨å‡½æ•°è°ƒç”¨ï¼Œé¡µé¢ä¼šå µå¡å¤§çº¦ 0.3 ç§’

æ³¨é‡Šæ‰ list2ï¼Œåªçœ‹ list1 ç›¸å…³ä»£ç çš„æ‰§è¡Œå †æ ˆå›¾ï¼š

![1703767814.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b9eb2ab0ccbf496fa684912e1de43def~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1459&h=618&s=93977&e=png&b=fbfbfb)

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ä»»åŠ¡è¢«æ‹†åˆ†åˆ°æ¯ä¸€å¸§ä¸åŒçš„ task ä¸­ï¼Œè¿™æ ·æµè§ˆå™¨å°±æœ‰å‰©ä½™æ—¶é—´æ‰§è¡Œæ ·å¼å¸ƒå±€å’Œæ ·å¼ç»˜åˆ¶ï¼Œå‡å°‘æ‰å¸§çš„å¯èƒ½æ€§

### 5. useDeferredValue

å¯ä»¥è®©æˆ‘ä»¬å»¶è¿Ÿæ¸²æŸ“ä¸ç´§æ€¥çš„éƒ¨åˆ†ï¼Œç±»ä¼¼äºé˜²æŠ–ä½†æ²¡æœ‰å›ºå®šçš„å»¶è¿Ÿæ—¶é—´

```js
import { useState, useDeferredValue } from 'react';

function SearchPage() {
  const [query, setQuery] = useState('');
  const deferredQuery = useDeferredValue(query);
  // ...
}
```

### 6. Fragment

å½“å‘ˆç°å¤šä¸ªå…ƒç´ è€Œä¸éœ€è¦é¢å¤–çš„å®¹å™¨å…ƒç´ æ—¶ï¼Œä½¿ç”¨ React.Fragment å¯ä»¥å‡å°‘ DOM èŠ‚ç‚¹çš„æ•°é‡ï¼Œä»è€Œæé«˜å‘ˆç°æ€§èƒ½

```js
const MyComponent = () => {
  return (
    <React.Fragment>
      <div>Element 1</div>
      <div>Element 2</div>
      <div>Element 3</div>
    </React.Fragment>
  );
};
```

### 7. åˆç†ä½¿ç”¨ Context

Context èƒ½å¤Ÿåœ¨ç»„ä»¶æ ‘é—´è·¨å±‚çº§æ•°æ®ä¼ é€’ï¼Œæ­£å› å…¶è¿™ä¸€ç‹¬ç‰¹æœºåˆ¶ï¼ŒContext å¯ä»¥ç»•è¿‡ React.memo æˆ– shouldComponentUpdate è®¾å®šçš„æ¯”è¾ƒè¿‡ç¨‹ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ Context çš„ Value å˜åŠ¨ï¼Œæ‰€æœ‰ä½¿ç”¨ useContext è·å–è¯¥ Context çš„ç»„ä»¶ä¼šå…¨éƒ¨ forceUpdateã€‚å³ä½¿è¯¥ç»„ä»¶ä½¿ç”¨äº† memoï¼Œä¸” Context æ›´æ–°çš„éƒ¨åˆ† Value ä¸å…¶æ— å…³

**ä¸ºäº†ä½¿ç»„ä»¶ä»…åœ¨ context ä¸å…¶ç›¸å…³çš„ value å‘ç”Ÿæ›´æ”¹æ—¶é‡æ–°æ¸²æŸ“ï¼Œå°†ç»„ä»¶åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ã€‚åœ¨å¤–å±‚ç»„ä»¶ä¸­ä» context ä¸­è¯»å–æ‰€éœ€å†…å®¹ï¼Œå¹¶å°†å…¶ä½œä¸º props ä¼ é€’ç»™ä½¿ç”¨ memo ä¼˜åŒ–çš„å­ç»„ä»¶ã€‚**

### 8. å°½é‡é¿å…ä½¿ç”¨ index ä½œä¸º key

åœ¨æ¸²æŸ“å…ƒç´ åˆ—è¡¨æ—¶ï¼Œå°½é‡é¿å…å°†æ•°ç»„ç´¢å¼•ä½œä¸ºç»„ä»¶çš„ keyã€‚å¦‚æœåˆ—è¡¨é¡¹æœ‰æ·»åŠ ã€åˆ é™¤åŠé‡æ–°æ’åºçš„æ“ä½œï¼Œä½¿ç”¨ index ä½œä¸º keyï¼Œå¯èƒ½ä¼šä½¿èŠ‚ç‚¹å¤ç”¨ç‡å˜ä½ï¼Œè¿›è€Œå½±å“æ€§èƒ½

ä½¿ç”¨æ•°æ®æºçš„ id ä½œä¸º key

```js
const MyComponent = () => {
  const items = [
    { id: 1, name: 'Item 1' },
    { id: 2, name: 'Item 2' },
    { id: 3, name: 'Item 3' },
  ];

  return (
    <ul>
      {items.map((item) => (
        <li key={item.id}>{item.name}</li>
      ))}
    </ul>
  );
};
```

### 9. æ‡’åŠ è½½

é€šè¿‡ React.lazy å’Œ React.Suspense å®æ–½ä»£ç åˆ†å‰²ç­–ç•¥ï¼Œå°† React åº”ç”¨ç»†åˆ†ä¸ºæ›´å°çš„æ¨¡å—ï¼Œç¡®ä¿åœ¨å…·ä½“éœ€æ±‚å‡ºç°æ—¶æ‰æŒ‰éœ€åŠ è½½ç›¸åº”çš„éƒ¨åˆ†

å®šä¹‰è·¯ç”±

```js
import { lazy } from 'react';
import { createBrowserRouter } from 'react-router-dom';

const Login = lazy(() => import('../pages/login'));

const routes = [
  {
    path: '/login',
    element: <Login />,
  },
];

//å¯ä¼ ç¬¬äºŒä¸ªå‚æ•°ï¼Œé…ç½®baseè·¯å¾„ { basename: "/app"}
const router = createBrowserRouter(routes);

export default router;
```

å¼•ç”¨è·¯ç”±

```js
import { Suspense } from 'react';
import { RouterProvider } from 'react-router-dom';

import ReactDOM from 'react-dom/client';

import router from './router';

const root = ReactDOM.createRoot(document.getElementById('root') as HTMLElement);

root.render(
  <Suspense fallback={<div>Loading...</div>}>
    <RouterProvider router={router} />
  </Suspense>,
);
```

### 10. ç»„ä»¶å¸è½½æ—¶çš„æ¸…ç†

åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…ç†å…¨å±€ç›‘å¬å™¨ã€å®šæ—¶å™¨ç­‰ã€‚é˜²æ­¢å†…å­˜æ³„æ¼å½±å“æ€§èƒ½

```js
import { useState, useEffect, useRef } from 'react';

function MyComponent() {
  const [count, setCount] = useState(0);
  const timer = useRef<NodeJS.Timeout>();

  useEffect(() => {
    // å®šä¹‰å®šæ—¶å™¨
    timer.current = setInterval(() => {
      setCount((count) => count + 1);
    }, 1000);

    const handleOnResize = () => {
      console.log('Window resized');
    };

    // å®šä¹‰ç›‘å¬å™¨
    window.addEventListener('resize', handleOnResize);

    // åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…é™¤å®šæ—¶å™¨å’Œç›‘å¬å™¨
    return () => {
      clearInterval(timer.current);
      window.removeEventListener('resize', handleOnResize);
    };
  }, []);

  return (
    <div>
      <p>{count}</p>
    </div>
  );
}

export default MyComponent;
```
