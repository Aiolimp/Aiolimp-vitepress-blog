---
title: 001 ES6-ES2020+æ–°ç‰¹æ€§
theme: solarized-dark
---

# ES6-ES2020+æ–°ç‰¹æ€§

## ES6 (ES2015) ä¸»è¦ç‰¹æ€§

### 1. let å’Œ const å£°æ˜

- `let`: å—çº§ä½œç”¨åŸŸå˜é‡å£°æ˜
- `const`: å—çº§ä½œç”¨åŸŸå¸¸é‡å£°æ˜

```javascript
// let ç¤ºä¾‹
for (let i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100); // è¾“å‡º 0, 1, 2
}

// const ç¤ºä¾‹
const API_URL = 'https://api.example.com';
const user = { name: 'John' };
user.name = 'Jane'; // å¯ä»¥ä¿®æ”¹å¯¹è±¡å±æ€§
// user = {}; // é”™è¯¯ï¼šä¸èƒ½é‡æ–°èµ‹å€¼
```

### 2. ç®­å¤´å‡½æ•°

ç®€åŒ–å‡½æ•°è¯­æ³•ï¼Œè‡ªåŠ¨ç»‘å®š this

```javascript
// ä¼ ç»Ÿå‡½æ•°
function add(a, b) {
  return a + b;
}

// ç®­å¤´å‡½æ•°
const add = (a, b) => a + b;

// å¤æ‚ç®­å¤´å‡½æ•°
const processUsers = (users) => {
  return users
    .filter((user) => user.active)
    .map((user) => ({
      ...user,
      displayName: `${user.firstName} ${user.lastName}`,
    }));
};
```

### 3. æ¨¡æ¿å­—ç¬¦ä¸²

ä½¿ç”¨åå¼•å·åˆ›å»ºå­—ç¬¦ä¸²ï¼Œæ”¯æŒå˜é‡æ’å€¼å’Œå¤šè¡Œ

```javascript
const name = 'World';
const greeting = `Hello, ${name}!`;

const multiLine = `
  è¿™æ˜¯ä¸€ä¸ª
  å¤šè¡Œå­—ç¬¦ä¸²
  ç¤ºä¾‹
`;

// æ ‡è®°æ¨¡æ¿å­—ç¬¦ä¸²
function highlight(strings, ...values) {
  return strings.reduce((result, string, i) => {
    return result + string + (values[i] ? `<mark>${values[i]}</mark>` : '');
  }, '');
}

const user = 'John';
const age = 30;
const html = highlight`ç”¨æˆ· ${user} å¹´é¾„ ${age} å²`;
```

### 4. è§£æ„èµ‹å€¼

ä»æ•°ç»„æˆ–å¯¹è±¡ä¸­æå–å€¼å¹¶èµ‹ç»™å˜é‡

```javascript
// æ•°ç»„è§£æ„
const [first, second, ...rest] = [1, 2, 3, 4, 5];
console.log(first, second, rest); // 1, 2, [3, 4, 5]

// å¯¹è±¡è§£æ„
const user = { name: 'John', age: 30, city: 'New York' };
const { name, age, city = 'Unknown' } = user;

// å‡½æ•°å‚æ•°è§£æ„
function greet({ name, age = 0 }) {
  return `Hello, ${name}! You are ${age} years old.`;
}

// åµŒå¥—è§£æ„
const data = {
  user: {
    profile: {
      name: 'John',
      settings: { theme: 'dark' },
    },
  },
};
const {
  user: {
    profile: {
      name,
      settings: { theme },
    },
  },
} = data;
```

### 5. é»˜è®¤å‚æ•°

ä¸ºå‡½æ•°å‚æ•°è®¾ç½®é»˜è®¤å€¼

```javascript
function greet(name = 'Guest', greeting = 'Hello') {
  return `${greeting}, ${name}!`;
}

// ä½¿ç”¨å…¶ä»–å‚æ•°ä½œä¸ºé»˜è®¤å€¼
function createUser(name, role = 'user', permissions = getDefaultPermissions(role)) {
  return { name, role, permissions };
}

function getDefaultPermissions(role) {
  return role === 'admin' ? ['read', 'write', 'delete'] : ['read'];
}
```

### 6. æ‰©å±•è¿ç®—ç¬¦ (Spread Operator)

å±•å¼€æ•°ç»„ã€å¯¹è±¡æˆ–å­—ç¬¦ä¸²

```javascript
// æ•°ç»„æ‰©å±•
const arr1 = [1, 2, 3];
const arr2 = [4, 5, 6];
const combined = [...arr1, ...arr2]; // [1, 2, 3, 4, 5, 6]

// å¯¹è±¡æ‰©å±•
const user = { name: 'John', age: 30 };
const updatedUser = { ...user, age: 31, city: 'New York' };

// å‡½æ•°è°ƒç”¨
function sum(a, b, c) {
  return a + b + c;
}
const numbers = [1, 2, 3];
console.log(sum(...numbers));

// å­—ç¬¦ä¸²æ‰©å±•
const chars = [...'Hello']; // ['H', 'e', 'l', 'l', 'o']
```

### 7. å‰©ä½™å‚æ•° (Rest Parameters)

æ”¶é›†å‰©ä½™å‚æ•°ä¸ºæ•°ç»„

```javascript
function sum(...numbers) {
  return numbers.reduce((total, num) => total + num, 0);
}

console.log(sum(1, 2, 3, 4)); // 10

// ä¸æ™®é€šå‚æ•°ç»“åˆ
function greetUsers(greeting, ...names) {
  return names.map((name) => `${greeting}, ${name}!`);
}
```

### 8. ç±» (Classes)

é¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­æ³•ç³–

```javascript
class Person {
  constructor(name, age) {
    this.name = name;
    this.age = age;
  }

  greet() {
    return `Hello, I'm ${this.name}`;
  }

  static createAdult(name) {
    return new Person(name, 18);
  }
}

class Student extends Person {
  constructor(name, age, grade) {
    super(name, age);
    this.grade = grade;
  }

  study() {
    return `${this.name} is studying`;
  }

  greet() {
    return `${super.greet()}, I'm in grade ${this.grade}`;
  }
}

const student = new Student('Alice', 16, 10);
```

### 9. æ¨¡å— (Modules)

ES6 æ¨¡å—ç³»ç»Ÿ

```javascript
// math.js
export const PI = 3.14159;
export function add(a, b) {
  return a + b;
}
export default function multiply(a, b) {
  return a * b;
}

// main.js
import multiply, { PI, add } from './math.js';
import * as math from './math.js';

// åŠ¨æ€å¯¼å…¥
async function loadModule() {
  const module = await import('./math.js');
  return module.default(2, 3);
}
```

### 10. Promise

å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ

```javascript
// åˆ›å»º Promise
const fetchData = (url) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      if (url) {
        resolve({ data: 'Success' });
      } else {
        reject(new Error('URL is required'));
      }
    }, 1000);
  });
};

// ä½¿ç”¨ Promise
fetchData('https://api.example.com')
  .then((result) => console.log(result))
  .catch((error) => console.error(error))
  .finally(() => console.log('è¯·æ±‚å®Œæˆ'));

// Promise.all
Promise.all([fetchData('url1'), fetchData('url2'), fetchData('url3')]).then((results) => {
  console.log('æ‰€æœ‰è¯·æ±‚å®Œæˆ:', results);
});
```

### 11. Map å’Œ Set

æ–°çš„æ•°æ®ç»“æ„

```javascript
// Map
const userRoles = new Map();
userRoles.set('john', 'admin');
userRoles.set('jane', 'user');
userRoles.set(123, 'guest'); // å¯ä»¥ä½¿ç”¨ä»»ä½•ç±»å‹ä½œä¸ºé”®

console.log(userRoles.get('john')); // 'admin'
console.log(userRoles.has('jane')); // true
console.log(userRoles.size); // 3

// Set
const uniqueNumbers = new Set([1, 2, 2, 3, 3, 4]);
console.log(uniqueNumbers); // Set { 1, 2, 3, 4 }

uniqueNumbers.add(5);
uniqueNumbers.delete(1);
console.log(uniqueNumbers.has(2)); // true
```

### 12. Symbol

æ–°çš„åŸå§‹æ•°æ®ç±»å‹

```javascript
// åˆ›å»º Symbol
const id = Symbol('id');
const id2 = Symbol('id');
console.log(id === id2); // false

// å¯¹è±¡å±æ€§
const user = {
  name: 'John',
  [id]: 123,
};

// å†…ç½® Symbol
const obj = {
  [Symbol.iterator]: function* () {
    yield 1;
    yield 2;
    yield 3;
  },
};

for (const value of obj) {
  console.log(value); // 1, 2, 3
}
```

## ES2016 (ES7) ä¸»è¦ç‰¹æ€§

### 1. Array.prototype.includes()

æ£€æŸ¥æ•°ç»„æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ 

```javascript
const fruits = ['apple', 'banana', 'orange'];
console.log(fruits.includes('banana')); // true
console.log(fruits.includes('grape')); // false

// æŒ‡å®šèµ·å§‹ä½ç½®
console.log(fruits.includes('apple', 1)); // false

// å¤„ç† NaN
const numbers = [1, 2, NaN, 4];
console.log(numbers.includes(NaN)); // true
```

### 2. æŒ‡æ•°è¿ç®—ç¬¦ (\*\*)

å¹‚è¿ç®—çš„ç®€åŒ–è¯­æ³•

```javascript
// ä¼ ç»Ÿæ–¹å¼
console.log(Math.pow(2, 3)); // 8

// ES2016 æ–¹å¼
console.log(2 ** 3); // 8
console.log(2 ** (3 ** 2)); // 2 ** (3 ** 2) = 2 ** 9 = 512

// å¤åˆèµ‹å€¼
let num = 2;
num **= 3;
console.log(num); // 8
```

## ES2017 (ES8) ä¸»è¦ç‰¹æ€§

### 1. async/await

å¼‚æ­¥å‡½æ•°çš„è¯­æ³•ç³–

```javascript
// ä½¿ç”¨ async/await
async function fetchUserData(userId) {
  try {
    const user = await fetch(`/users/${userId}`);
    const userData = await user.json();
    const posts = await fetch(`/users/${userId}/posts`);
    const postsData = await posts.json();

    return {
      user: userData,
      posts: postsData,
    };
  } catch (error) {
    console.error('è·å–ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
    throw error;
  }
}

// å¹¶è¡Œæ‰§è¡Œ
async function fetchMultipleUsers(userIds) {
  const promises = userIds.map((id) => fetchUserData(id));
  const results = await Promise.all(promises);
  return results;
}
```

### 2. Object.values() å’Œ Object.entries()

è·å–å¯¹è±¡çš„å€¼å’Œé”®å€¼å¯¹

```javascript
const user = {
  name: 'John',
  age: 30,
  city: 'New York',
};

// Object.values()
console.log(Object.values(user)); // ['John', 30, 'New York']

// Object.entries()
console.log(Object.entries(user));
// [['name', 'John'], ['age', 30], ['city', 'New York']]

// å®é™…åº”ç”¨
Object.entries(user).forEach(([key, value]) => {
  console.log(`${key}: ${value}`);
});

// è½¬æ¢ä¸º Map
const userMap = new Map(Object.entries(user));
```

### 3. String.prototype.padStart() å’Œ padEnd()

å­—ç¬¦ä¸²å¡«å……æ–¹æ³•

```javascript
// padStart()
const num = '5';
console.log(num.padStart(3, '0')); // '005'
console.log(num.padStart(5, 'x')); // 'xxxx5'

// padEnd()
const str = 'Hello';
console.log(str.padEnd(10, '.')); // 'Hello.....'

// å®é™…åº”ç”¨ï¼šæ ¼å¼åŒ–æ—¶é—´
function formatTime(hours, minutes) {
  return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
}
console.log(formatTime(9, 5)); // '09:05'
```

### 4. Object.getOwnPropertyDescriptors()

è·å–å¯¹è±¡æ‰€æœ‰è‡ªæœ‰å±æ€§çš„æè¿°ç¬¦

```javascript
const obj = {
  name: 'John',
  get age() {
    return this._age;
  },
  set age(value) {
    this._age = value;
  },
};

const descriptors = Object.getOwnPropertyDescriptors(obj);
console.log(descriptors);

// æµ…æ‹·è´åŒ…æ‹¬ getter/setter
const copy = Object.create(Object.getPrototypeOf(obj), Object.getOwnPropertyDescriptors(obj));
```

### 5. å‡½æ•°å‚æ•°åˆ—è¡¨å’Œè°ƒç”¨ä¸­çš„å°¾éšé€—å·

å…è®¸åœ¨å‚æ•°åˆ—è¡¨æœ«å°¾æ·»åŠ é€—å·

```javascript
function greet(
  name,
  age,
  city // å°¾éšé€—å·
) {
  return `Hello ${name}`;
}

greet(
  'John',
  30,
  'New York' // å°¾éšé€—å·
);
```

## ES2018 (ES9) ä¸»è¦ç‰¹æ€§

### 1. å¼‚æ­¥è¿­ä»£å™¨ (for-await-of)

å¤„ç†å¼‚æ­¥å¯è¿­ä»£å¯¹è±¡

```javascript
async function* asyncGenerator() {
  yield await Promise.resolve(1);
  yield await Promise.resolve(2);
  yield await Promise.resolve(3);
}

async function processAsyncData() {
  for await (const value of asyncGenerator()) {
    console.log(value); // 1, 2, 3
  }
}

// å¤„ç†å¤šä¸ªå¼‚æ­¥æ“ä½œ
async function processFiles(fileUrls) {
  for await (const url of fileUrls) {
    const response = await fetch(url);
    const data = await response.text();
    console.log(`å¤„ç†æ–‡ä»¶: ${url}`);
  }
}
```

### 2. Rest/Spread å±æ€§

å¯¹è±¡çš„å‰©ä½™å’Œæ‰©å±•å±æ€§

```javascript
// Rest å±æ€§
const user = {
  name: 'John',
  age: 30,
  email: 'john@example.com',
  phone: '123-456-7890',
};

const { name, age, ...contactInfo } = user;
console.log(contactInfo); // { email: '...', phone: '...' }

// Spread å±æ€§
const defaultSettings = { theme: 'light', language: 'en' };
const userSettings = { language: 'zh', notifications: true };
const finalSettings = { ...defaultSettings, ...userSettings };
// { theme: 'light', language: 'zh', notifications: true }

// å‡½æ•°ä¸­ä½¿ç”¨
function updateUser(id, updates) {
  const currentUser = getUserById(id);
  return { ...currentUser, ...updates, updatedAt: new Date() };
}
```

### 3. Promise.prototype.finally()

æ— è®º Promise çŠ¶æ€å¦‚ä½•éƒ½ä¼šæ‰§è¡Œçš„å›è°ƒ

```javascript
function fetchData() {
  setLoading(true);

  return fetch('/api/data')
    .then((response) => response.json())
    .then((data) => {
      setData(data);
      return data;
    })
    .catch((error) => {
      setError(error);
      throw error;
    })
    .finally(() => {
      setLoading(false); // æ— è®ºæˆåŠŸå¤±è´¥éƒ½ä¼šæ‰§è¡Œ
    });
}
```

### 4. æ­£åˆ™è¡¨è¾¾å¼æ”¹è¿›

#### å‘½åæ•è·ç»„

```javascript
const regex = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/;
const match = '2023-12-25'.match(regex);
console.log(match.groups); // { year: '2023', month: '12', day: '25' }

// æ›¿æ¢ä¸­ä½¿ç”¨å‘½åç»„
const newDate = '2023-12-25'.replace(/(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/, '$<day>/$<month>/$<year>');
console.log(newDate); // '25/12/2023'
```

#### dotAll æ ‡å¿—

```javascript
// ä¼ ç»Ÿæ–¹å¼ï¼š. ä¸åŒ¹é…æ¢è¡Œç¬¦
const text = 'Hello\nWorld';
console.log(/Hello.World/.test(text)); // false

// ä½¿ç”¨ dotAll æ ‡å¿—
console.log(/Hello.World/s.test(text)); // true
```

#### Unicode å±æ€§è½¬ä¹‰

```javascript
// åŒ¹é…æ‰€æœ‰è¡¨æƒ…ç¬¦å·
const emojiRegex = /\p{Emoji}/u;
console.log(emojiRegex.test('ğŸ˜€')); // true

// åŒ¹é…ä¸­æ–‡å­—ç¬¦
const chineseRegex = /\p{Script=Han}/u;
console.log(chineseRegex.test('ä¸­æ–‡')); // true
```

#### åè¡Œæ–­è¨€

```javascript
// æ­£å‘åè¡Œæ–­è¨€
const regex1 = /(?<=\$)\d+/;
console.log('$100'.match(regex1)); // ['100']

// è´Ÿå‘åè¡Œæ–­è¨€
const regex2 = /(?<!\$)\d+/;
console.log('100 $200'.match(regex2)); // ['100']
```

## ES2019 (ES10) ä¸»è¦ç‰¹æ€§

### 1. Array.prototype.flat() å’Œ flatMap()

æ•°ç»„æ‰å¹³åŒ–æ–¹æ³•

```javascript
// flat() - æ‰å¹³åŒ–æ•°ç»„
const nested = [1, [2, 3], [4, [5, 6]]];
console.log(nested.flat()); // [1, 2, 3, 4, [5, 6]]
console.log(nested.flat(2)); // [1, 2, 3, 4, 5, 6]
console.log(nested.flat(Infinity)); // å®Œå…¨æ‰å¹³åŒ–

// flatMap() - æ˜ å°„åæ‰å¹³åŒ–
const sentences = ['Hello world', 'How are you'];
const words = sentences.flatMap((sentence) => sentence.split(' '));
console.log(words); // ['Hello', 'world', 'How', 'are', 'you']

// å®é™…åº”ç”¨
const users = [
  { name: 'John', hobbies: ['reading', 'gaming'] },
  { name: 'Jane', hobbies: ['cooking', 'painting'] },
];
const allHobbies = users.flatMap((user) => user.hobbies);
console.log(allHobbies); // ['reading', 'gaming', 'cooking', 'painting']
```

### 2. Object.fromEntries()

å°†é”®å€¼å¯¹åˆ—è¡¨è½¬æ¢ä¸ºå¯¹è±¡

```javascript
// ä»æ•°ç»„åˆ›å»ºå¯¹è±¡
const entries = [
  ['name', 'John'],
  ['age', 30],
];
const obj = Object.fromEntries(entries);
console.log(obj); // { name: 'John', age: 30 }

// ä» Map åˆ›å»ºå¯¹è±¡
const map = new Map([
  ['a', 1],
  ['b', 2],
]);
const objFromMap = Object.fromEntries(map);

// å®é™…åº”ç”¨ï¼šè¿‡æ»¤å¯¹è±¡å±æ€§
const user = { name: 'John', age: 30, password: '123', email: 'john@example.com' };
const publicUser = Object.fromEntries(Object.entries(user).filter(([key]) => key !== 'password'));
console.log(publicUser); // { name: 'John', age: 30, email: '...' }
```

### 3. String.prototype.trimStart() å’Œ trimEnd()

å­—ç¬¦ä¸²é¦–å°¾ç©ºç™½ç¬¦æ¸…ç†

```javascript
const str = '   Hello World   ';

console.log(str.trimStart()); // 'Hello World   '
console.log(str.trimEnd()); // '   Hello World'
console.log(str.trim()); // 'Hello World'

// åˆ«åï¼ˆä¸ºäº†å‘åå…¼å®¹ï¼‰
console.log(str.trimLeft()); // ç­‰åŒäº trimStart()
console.log(str.trimRight()); // ç­‰åŒäº trimEnd()
```

### 4. try...catch å¯é€‰çš„ç»‘å®šå‚æ•°

catch å­å¥ä¸éœ€è¦é”™è¯¯å‚æ•°

```javascript
// ES2019 ä¹‹å‰
try {
  JSON.parse(invalidJSON);
} catch (error) {
  // å³ä½¿ä¸ä½¿ç”¨ errorï¼Œä¹Ÿå¿…é¡»å£°æ˜
  console.log('JSON è§£æå¤±è´¥');
}

// ES2019
try {
  JSON.parse(invalidJSON);
} catch {
  // å¯ä»¥çœç•¥é”™è¯¯å‚æ•°
  console.log('JSON è§£æå¤±è´¥');
}
```

### 5. ç¨³å®šçš„ Array.prototype.sort()

ç¡®ä¿æ’åºçš„ç¨³å®šæ€§

```javascript
const items = [
  { name: 'John', age: 30 },
  { name: 'Jane', age: 25 },
  { name: 'Bob', age: 30 },
];

// æŒ‰å¹´é¾„æ’åºï¼Œç›¸åŒå¹´é¾„çš„ä¿æŒåŸæœ‰é¡ºåº
const sorted = items.sort((a, b) => a.age - b.age);
// ç¨³å®šæ’åºç¡®ä¿ John åœ¨ Bob ä¹‹å‰ï¼ˆåŸæœ‰é¡ºåºï¼‰
```

## ES2020 (ES11) ä¸»è¦ç‰¹æ€§

### 1. å¯é€‰é“¾ (Optional Chaining)

å®‰å…¨è®¿é—®æ·±å±‚åµŒå¥—çš„å¯¹è±¡å±æ€§

```javascript
const user = {
  profile: {
    personal: {
      name: 'John',
    },
  },
};

// ä¼ ç»Ÿæ–¹å¼
const name = user && user.profile && user.profile.personal && user.profile.personal.name;

// å¯é€‰é“¾
const name = user?.profile?.personal?.name;
const age = user?.profile?.personal?.age ?? 'Unknown';

// æ–¹æ³•è°ƒç”¨
user?.profile?.updateProfile?.();

// æ•°ç»„ç´¢å¼•
const firstHobby = user?.hobbies?.[0];

// åŠ¨æ€å±æ€§
const prop = 'personal';
const info = user?.profile?.[prop]?.name;
```

### 2. ç©ºå€¼åˆå¹¶ (Nullish Coalescing)

å¤„ç† null å’Œ undefined å€¼

```javascript
// åªæœ‰åœ¨ null æˆ– undefined æ—¶æ‰ä½¿ç”¨é»˜è®¤å€¼
const name = user.name ?? 'Guest';
const count = user.count ?? 0; // å³ä½¿ count æ˜¯ 0 ä¹Ÿä¸ä¼šä½¿ç”¨é»˜è®¤å€¼

// ä¸ || çš„åŒºåˆ«
const value1 = user.value || 'default'; // falsy å€¼éƒ½ä¼šä½¿ç”¨é»˜è®¤å€¼
const value2 = user.value ?? 'default'; // åªæœ‰ null/undefined ä½¿ç”¨é»˜è®¤å€¼

console.log(0 || 'default'); // 'default'
console.log(0 ?? 'default'); // 0
console.log('' || 'default'); // 'default'
console.log('' ?? 'default'); // ''
console.log(false || 'default'); // 'default'
console.log(false ?? 'default'); // false
```

### 3. BigInt

ä»»æ„ç²¾åº¦æ•´æ•°

```javascript
// åˆ›å»º BigInt
const bigNum1 = 123n;
const bigNum2 = BigInt('123456789012345678901234567890');

// è¿ç®—
console.log(bigNum1 + 456n); // 579n
console.log(bigNum2 * 2n);

// æ³¨æ„ï¼šä¸èƒ½æ··åˆ BigInt å’Œ Number
// console.log(bigNum1 + 123); // é”™è¯¯
console.log(bigNum1 + BigInt(123)); // æ­£ç¡®

// æ¯”è¾ƒ
console.log(10n > 5); // true
console.log(10n === 10); // false
console.log(10n == 10); // true

// å®é™…åº”ç”¨ï¼šå¤„ç†å¤§æ•´æ•° ID
const userId = BigInt(Number.MAX_SAFE_INTEGER) + 1n;
```

### 4. åŠ¨æ€å¯¼å…¥ (Dynamic Import)

è¿è¡Œæ—¶åŠ¨æ€åŠ è½½æ¨¡å—

```javascript
// æ¡ä»¶å¯¼å…¥
async function loadFeature(featureName) {
  if (featureName === 'chart') {
    const { Chart } = await import('./chart.js');
    return new Chart();
  } else if (featureName === 'table') {
    const { Table } = await import('./table.js');
    return new Table();
  }
}

// æ‡’åŠ è½½
button.addEventListener('click', async () => {
  const { heavyFunction } = await import('./heavy-module.js');
  heavyFunction();
});

// é”™è¯¯å¤„ç†
try {
  const module = await import('./module.js');
  module.init();
} catch (error) {
  console.error('æ¨¡å—åŠ è½½å¤±è´¥:', error);
}
```

### 5. globalThis

å…¨å±€å¯¹è±¡çš„æ ‡å‡†åŒ–è®¿é—®

```javascript
// åœ¨ä¸åŒç¯å¢ƒä¸­è®¿é—®å…¨å±€å¯¹è±¡
// æµè§ˆå™¨: window
// Node.js: global
// Web Workers: self

// ç»Ÿä¸€çš„å…¨å±€å¯¹è±¡è®¿é—®
const global = globalThis;

// å®‰å…¨åœ°è®¿é—®å…¨å±€å˜é‡
const fetch = globalThis.fetch || require('node-fetch');
```

### 6. Promise.allSettled()

ç­‰å¾…æ‰€æœ‰ Promise å®Œæˆï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰

```javascript
const promises = [
  fetch('/api/user/1'),
  fetch('/api/user/2'),
  fetch('/api/invalid-url'), // è¿™ä¸ªä¼šå¤±è´¥
];

// Promise.all åœ¨ä»»ä½•ä¸€ä¸ªå¤±è´¥æ—¶å°±ä¼š reject
// Promise.allSettled ä¼šç­‰å¾…æ‰€æœ‰å®Œæˆ
Promise.allSettled(promises).then((results) => {
  results.forEach((result, index) => {
    if (result.status === 'fulfilled') {
      console.log(`è¯·æ±‚ ${index} æˆåŠŸ:`, result.value);
    } else {
      console.log(`è¯·æ±‚ ${index} å¤±è´¥:`, result.reason);
    }
  });
});

// å®é™…åº”ç”¨ï¼šæ‰¹é‡å¤„ç†ç”¨æˆ·æ•°æ®
async function processUsers(userIds) {
  const userPromises = userIds.map((id) => fetchUser(id));
  const results = await Promise.allSettled(userPromises);

  const successfulUsers = results.filter((result) => result.status === 'fulfilled').map((result) => result.value);

  const failedUserIds = results
    .map((result, index) => (result.status === 'rejected' ? userIds[index] : null))
    .filter(Boolean);

  return { successfulUsers, failedUserIds };
}
```

### 7. String.prototype.matchAll()

å…¨å±€åŒ¹é…æ‰€æœ‰æ­£åˆ™è¡¨è¾¾å¼ç»“æœ

```javascript
const text = 'test1 test2 test3';
const regex = /test(\d)/g;

// ä¼ ç»Ÿæ–¹å¼
let match;
const matches = [];
while ((match = regex.exec(text)) !== null) {
  matches.push(match);
}

// ä½¿ç”¨ matchAll
const matches = [...text.matchAll(regex)];
console.log(matches);
// [
//   ['test1', '1', index: 0, input: 'test1 test2 test3'],
//   ['test2', '2', index: 6, input: 'test1 test2 test3'],
//   ['test3', '3', index: 12, input: 'test1 test2 test3']
// ]

// å®é™…åº”ç”¨ï¼šæå–æ‰€æœ‰é“¾æ¥
const html = '<a href="/page1">Link1</a> <a href="/page2">Link2</a>';
const linkRegex = /<a href="([^"]+)">([^<]+)<\/a>/g;
const links = [...html.matchAll(linkRegex)].map((match) => ({
  url: match[1],
  text: match[2],
}));
```

### 8. æ ‡å‡†åŒ–çš„ for-in æšä¸¾é¡ºåº

ç¡®ä¿ for-in å¾ªç¯çš„å±æ€§æšä¸¾é¡ºåº

```javascript
const obj = {
  2: 'two',
  1: 'one',
  b: 'letter b',
  a: 'letter a',
};

// ES2020 ä¿è¯äº†æšä¸¾é¡ºåº
for (const key in obj) {
  console.log(key); // '1', '2', 'a', 'b'
}
// æ•°å­—é”®æŒ‰æ•°å€¼æ’åºï¼Œå­—ç¬¦ä¸²é”®æŒ‰åˆ›å»ºé¡ºåº
```

## æ€»ç»“

### é‡è¦æ€§æ’åº

1. **ES6**: é©å‘½æ€§æ›´æ–°ï¼Œå¼•å…¥äº†ç°ä»£ JavaScript çš„åŸºç¡€
2. **ES2017**: async/await å¤§å¹…æ”¹å–„å¼‚æ­¥ç¼–ç¨‹ä½“éªŒ
3. **ES2020**: å¯é€‰é“¾å’Œç©ºå€¼åˆå¹¶è§£å†³äº†å¸¸è§çš„å®‰å…¨è®¿é—®é—®é¢˜
4. **ES2018**: Rest/Spread å±æ€§å®Œå–„äº†å¯¹è±¡æ“ä½œ
5. **ES2019**: æ•°ç»„æ‰å¹³åŒ–å’Œå¯¹è±¡è½¬æ¢æ–¹æ³•

### å®é™…å¼€å‘å»ºè®®

1. **ä¼˜å…ˆæŒæ¡**: ES6 åŸºç¡€ã€async/awaitã€å¯é€‰é“¾ã€ç©ºå€¼åˆå¹¶
2. **é€æ­¥é‡‡ç”¨**: æ ¹æ®é¡¹ç›®éœ€æ±‚å’Œæµè§ˆå™¨æ”¯æŒæƒ…å†µé€‰æ‹©æ€§ä½¿ç”¨æ–°ç‰¹æ€§
3. **å·¥å…·æ”¯æŒ**: ä½¿ç”¨ Babel ç­‰å·¥å…·ç¡®ä¿å…¼å®¹æ€§
4. **æ€§èƒ½è€ƒè™‘**: äº†è§£å„ç‰¹æ€§çš„æ€§èƒ½å½±å“ï¼Œåˆç†é€‰æ‹©

### æŒç»­å­¦ä¹ 

JavaScript æ ‡å‡†æ¯å¹´éƒ½ä¼šæ›´æ–°ï¼Œå»ºè®®ï¼š

- å…³æ³¨ TC39 ææ¡ˆè¿›å±•
- å®è·µæ–°ç‰¹æ€§åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨
- äº†è§£æµè§ˆå™¨å’Œ Node.js çš„æ”¯æŒæƒ…å†µ
- å‚ä¸ç¤¾åŒºè®¨è®ºå’Œæœ€ä½³å®è·µåˆ†äº«
